{% extends 'base.html.twig' %}

{% block title %}Accueil Technicien{% endblock %}

{% block body %}
<h1 class="title">Accueil Technicien</h1>

<div class="container">
    <div class="listeSalles">
        {% for batiment, salles in diagnostics %}
            <!-- Titre du bâtiment -->
            <div class="batiment">
                <h2>Bâtiment : {{ batiment }}</h2>
                <div class="sallesrow">
                    {% for salle, issues in salles %}
                        <div class="card" id="card">
                            <div class="cardMainInfos">
                                <div class="card-top">
                                    <p class="room-name">{{ salle }}</p>
                                    {% if issues is same as([]) %}
                                        <!-- Aucune donnée disponible -->
                                        <span class="text-danger">Aucune donnée disponible</span>
                                    {% else %}
                                        {% if issues is empty %}
                                            <!-- Aucun problème -->
                                            <span class="text-success">Aucun problème détecté</span>
                                        {% else %}
                                            <!-- Problèmes détectés -->
                                            <span class="text-warning">Problèmes détectés : {{ issues|join(', ') }}</span>
                                        {% endif %}
                                    {% endif %}
                                    <div class="etat">
                                        <p class="status" id="status">
                                        <div class="pastilleStatus"
                                             style="background-color: {% if issues is same as([]) %}red{% elseif issues is empty %}green{% else %}orange{% endif %}">
                                        </div>
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Contenu caché qui s'affichera au clic -->
                            <div class="card-content" style="display: none;">
                                <p class="location">Salle : {{ salle }}</p>
                                {% if issues is same as([]) %}
                                    <h3 style="font-size: 20px; text-align: center">Aucune donnée disponible !</h3>
                                {% elseif issues is empty %}
                                    <h3 style="font-size: 18px;">Aucun problème détecté.</h3>
                                {% else %}
                                    <h3 style="font-size: 18px;">Détails des problèmes détectés :</h3>
                                    <ul>
                                        {% for issue in issues %}
                                            <li>{{ issue }}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <p>Aucun bâtiment trouvé.</p>
        {% endfor %}

    </div>
    {% endblock %}

    {% block javascripts %}
        <style>/* Container for the list of rooms */
            /* Container for the list of rooms */


        </style>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const cards = document.querySelectorAll(".card");

                cards.forEach((card) => {
                    const cardContent = card.querySelector(".card-content");
                    const cardId = card.id; // ID unique de la carte

                    card.addEventListener("click", function (event) {
                        // Vérifie si la carte est déjà agrandie
                        const isExpanded = card.classList.contains("expanded");

                        // Fermer toutes les autres cartes
                        cards.forEach((otherCard) => {
                            if (otherCard.id !== cardId) { // Ne pas affecter la carte cliquée
                                otherCard.querySelector(".card-content").style.display = "none";
                                otherCard.classList.remove("expanded");
                            }
                        });

                        // Basculer l'état de la carte cliquée
                        if (!isExpanded) {
                            cardContent.style.display = "block";
                            card.classList.add("expanded");
                        } else {
                            cardContent.style.display = "none";
                            card.classList.remove("expanded");
                        }

                        // Stopper la propagation de l'événement
                        event.stopPropagation();
                    });
                });

                // Fermer toutes les cartes lorsqu'on clique à l'extérieur
                document.addEventListener("click", function () {
                    cards.forEach((card) => {
                        card.querySelector(".card-content").style.display = "none";
                        card.classList.remove("expanded");
                    });
                });
            });

        </script>
    {% endblock %}
